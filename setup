#!/bin/bash

user_name=$(whoami)
env_home="/home/$user_name/.ansible-venv"
python_ver="3.10.14"
python_url="https://www.python.org/ftp/python/$python_ver/Python-$python_ver.tgz"

echo "Скачиваем и распаковываем бинарный файл Python $python_ver"
curl -L $python_url -o /tmp/Python-$python_ver.tgz
tar -xzf /tmp/Python-$python_ver.tgz -C /tmp

python_path="/tmp/Python-$python_ver"

echo "Создаем и активируем виртуальную среду"
$python_path/bin/python3 -m venv $env_home
rm -rf /tmp/Python-$python_ver.tgz /tmp/Python-$python_ver

source $env_home/bin/activate

echo "Устанавливаем Ansible версии 2.12"
pip install ansible-core==2.12

echo "Устанавливаем python-netaddr"
pip install netaddr

echo "Устанавливаем jinja2 версии 3.0"
pip install jinja2==3.0

deactivate
echo "alias activate='source $env_home/bin/activate'" >> /home/$user_name/.bashrc
source /home/$user_name/.bashrc

echo "Для работы с Ansible нужно активировать виртуальную среду! Это можно сделать командой: activate"