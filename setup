#!/bin/bash

user_name=$(whoami)
env_home="/home/$user_name/.ansible-venv"
python_ver="3.10.14"

curl -sSL https://raw.githubusercontent.com/hexqueller/ansible-script/master/pyenv | bash

if ! command -v pyenv &> /dev/null; then
  echo "Ошибка: pyenv не установлен"
  exit 1
fi

echo "Устанавливаем Python $python_ver с помощью pyenv"
pyenv install $python_ver

pyenv global $python_ver

echo "Создаем виртуальную среду"
python -m venv $env_home

source $env_home/bin/activate

echo "Устанавливаем Ansible версии 2.12"
pip install ansible-core==2.12

echo "Устанавливаем python-netaddr"
pip install netaddr

echo "Устанавливаем jinja2 версии 3.0"
pip install jinja2==3.0

deactivate
echo "alias activate='source $env_home/bin/activate'" >> /home/$user_name/.bashrc
source /home/$user_name/.bashrc

echo "Для работы с Ansible нужно активировать виртуальную среду! Это можно сделать командой: activate"